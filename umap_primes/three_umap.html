<!DOCTYPE html>
<html>
	<head>
		<meta charset=utf-8>
		<title>One million integers (3D)</title>
		<style>
			body { margin: 0; }
			canvas { width: 100%; height: 100% }
		</style>
	</head>
	<body>
        
        Controls: W,A,S,D; move, Q,E; roll (a la Elite), R/F up/down, mouse drag, move viewport (in an unintuitive way)


        <script src="js/three.min.js"></script>
        <script src="color_scale/plasma.json"></script>
        <script src="color_scale/interpolate.js"></script>
        <script src="https://threejs.org/examples/js/controls/FlyControls.js"></script>
        <script type="text/javascript" src="npy.js"></script>
        <script>

            var plasma_cmap = interpolateArray(plasma);

            onloaded = function(array)
            {
                var scene = new THREE.Scene();
                var camera = new THREE.PerspectiveCamera( 45, window.innerWidth / window.innerHeight, 0.1, 1000 );

                var renderer = new THREE.WebGLRenderer();
                renderer.setSize( window.innerWidth, window.innerHeight );
                document.body.appendChild( renderer.domElement );

                function animate() {
                    requestAnimationFrame( animate );
                    controls.update(1);

                   

                    renderer.render( scene, camera );
                }
            

                //constructs and empty object and attach controls to it
                var dummy = new THREE.Object3D();
                var controls = new THREE.FlyControls( camera );

                 //camera control properties
                 controls.movementSpeed = 0.015;
                controls.domElement = window.document;
                controls.rollSpeed = 0.01;
                
                controls.autoForward = false;
                controls.dragToLook = true;
                
                scene.add(dummy);
                dummy.add(camera);

                camera.position.z = 5;
                
                var n = 1000000;

                var pt_buffer = new THREE.BufferGeometry();
                var positions = new Float32Array(n*3); 
                var colours = new Float32Array(n*3);
                for(i=0;i<n;i++)
                {
                    var rgb = plasma_cmap(i/n);
                    colours[i*3] = rgb.r;
                    colours[i*3+1] = rgb.g;
                    colours[i*3+2] = rgb.b;
                    /*positions[i*3] = array.data[i*2];
                    positions[i*3+1] = array.data[i*2+1];
                    positions[i*3+2] = array.data[i*2+2];
                    */

                }
                
                pt_buffer.addAttribute('position', new THREE.BufferAttribute(array.data, 3));
                
                pt_buffer.addAttribute('color', new THREE.BufferAttribute(colours, 3));
                

                var material = new THREE.PointsMaterial( { size:0.002, sizeAttenuation: true, vertexColors: THREE.VertexColors, opacity:0.1, transparent:true,
                    blending:THREE.AdditiveBlending, depthTest:false
                
                } );
                var pts = new THREE.Points( pt_buffer,  material );
                pt_buffer.scale(0.2, 0.2, 1.0);
                scene.add(pts);

                animate();
            }

             NumpyLoader.ajax("1e6_pts_3d.npy", onloaded);
   
		</script>
	</body>
</html>