<!DOCTYPE html>
<html>
	<head>
		<meta charset=utf-8>
        <title>One million integers (3D)</title>
        <link rel="stylesheet"
      href="https://fonts.googleapis.com/css?family=Comfortaa">
        <link rel="stylesheet" type="text/css" href="style.css">
		<style>
			body { margin: 0; }
			canvas { width: 100%; height: 100% }
        </style>
         
         
                
    </head>
    <body id="body">
        <div class="heading">
            One million integers            
        </div>  
    
        <div class="text" id="controls">
           
        <b>W,A,S,D</b>; move, <b>Q,E</b>; roll (a la Elite), <b>R/F</b> up/down, <b>mouse drag</b>, move viewport (in an unintuitive way)
        <br> <a href="index.md.html"> Explanation </a>
    </div>  

        <script src="js/three.min.js"></script>
        <script src="color_scale/plasma.json"></script>
        <script src="color_scale/interpolate.js"></script>
        <script src="https://threejs.org/examples/js/controls/FlyControls.js"></script>
        <script type="text/javascript" src="npy.js"></script>
        <script>
           // for plasma colouring
           var plasma_cmap = interpolateArray(plasma);
            
            onloaded = function(pt_array, col_array)
            {
  
                var scene = new THREE.Scene();
                var camera = new THREE.PerspectiveCamera( 45, window.innerWidth / window.innerHeight, 0.1, 1000 );

                var renderer = new THREE.WebGLRenderer();
                renderer.setSize( window.innerWidth, window.innerHeight );
                document.body.appendChild( renderer.domElement );

                // animate loop
                function animate() {
                    requestAnimationFrame( animate );
                    controls.update(1);
                    renderer.render( scene, camera );
                }
            
                var dummy = new THREE.Object3D();
                var controls = new THREE.FlyControls( camera );

                 //camera control properties
                 controls.movementSpeed = 0.015;
                 controls.domElement = window.document;
                 controls.rollSpeed = 0.01;
                
                 controls.autoForward = false;
                 controls.dragToLook = true;
                
                 scene.add(dummy);
                 dummy.add(camera);

                 camera.position.z = 5;
                
                 var n = 1000000;

                 // Create the geometry, and set the attribute arrays
                 var pt_buffer = new THREE.BufferGeometry();
                
                 var colours = new Float32Array(n*3);
                 var pts = new Float32Array(n*3);
                for(i=0;i<n;i++)
                {
                    /* var rgb = plasma_cmap(i/n);
                    
                    colours[i*3] = rgb.r;
                    colours[i*3+1] = rgb.g;
                    colours[i*3+2] = rgb.b;                    */
                    
                    pts[i*3] = pt_array.data[i*3] / 32768.0;
                    pts[i*3+1] = pt_array.data[i*3+1] / 32768.0;
                    pts[i*3+2] = pt_array.data[i*3+2] / 32768.0;
                    colours[i*3] = col_array.data[i*3]/255.0;
                    colours[i*3+1] = col_array.data[i*3+1]/255.0;
                    colours[i*3+2] = col_array.data[i*3+2]/255.0;                    
                }
                
                pt_buffer.addAttribute('position', new THREE.BufferAttribute(pts, 3));                
                pt_buffer.addAttribute('color', new THREE.BufferAttribute(colours, 3));                

                var material = new THREE.PointsMaterial( { size:0.008, sizeAttenuation: true, vertexColors: THREE.VertexColors, opacity:0.1, transparent:true,
                    //blending:THREE.AdditiveBlending, 
                    depthTest:false
                
                } );
                var pts = new THREE.Points( pt_buffer,  material );
                pt_buffer.scale(2, 2, 2);
                camera.lookAt(0,0.7,0);
                scene.add(pts);

                var three_div = document.createElement('div');
                three_div.className = 'text';
                three_div.innerHTML = "<br>Powered by <a href=\"https://threejs.org/\"> three.js </a>";
                document.body.appendChild(three_div); 
                animate();
            }

     
            function onloaded_stage_1 (pt_array)
            {
                
                
                NumpyLoader.ajax("1e6_pts_rgb.npy", function (col_array) { onloaded(pt_array, col_array); });
            }

            NumpyLoader.ajax("1e6_pts_3d_int16.npy", onloaded_stage_1);
   
        </script>

        
	</body>
</html>