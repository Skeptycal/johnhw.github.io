<!DOCTYPE html>
<html>
	<head>
		<meta charset=utf-8>
        <title>One million integers (3D)</title>
        <link rel="stylesheet"
      href="https://fonts.googleapis.com/css?family=Comfortaa">
        <link rel="stylesheet" type="text/css" href="style.css">
		<style>
			body { margin: 0; }
			canvas { width: 100%; height: 100% }
        </style>
         
         
                
    </head>
    
        <div class="heading">
            One million integers            
        </div>  
    
        <div class="controls">
           
        Controls: W,A,S,D; move, Q,E; roll (a la Elite), R/F up/down, mouse drag, move viewport (in an unintuitive way)
        <br> <a href="index.md.html"> Explanation of what you are seeing
    </div>  

        <script src="js/three.min.js"></script>
        <script src="color_scale/plasma.json"></script>
        <script src="color_scale/interpolate.js"></script>
        <script src="https://threejs.org/examples/js/controls/FlyControls.js"></script>
        <script type="text/javascript" src="npy.js"></script>
        <script>

            var plasma_cmap = interpolateArray(plasma);
            
            onloaded = function(pt_array, col_array)
            {

                var scene = new THREE.Scene();
                var camera = new THREE.PerspectiveCamera( 45, window.innerWidth / window.innerHeight, 0.1, 1000 );

                var renderer = new THREE.WebGLRenderer();
                renderer.setSize( window.innerWidth, window.innerHeight );
                document.body.appendChild( renderer.domElement );

                function animate() {
                    requestAnimationFrame( animate );
                    controls.update(1);

                   

                    renderer.render( scene, camera );
                }
            

                //constructs and empty object and attach controls to it
                var dummy = new THREE.Object3D();
                var controls = new THREE.FlyControls( camera );

                 //camera control properties
                 controls.movementSpeed = 0.015;
                controls.domElement = window.document;
                controls.rollSpeed = 0.01;
                
                controls.autoForward = false;
                controls.dragToLook = true;
                
                scene.add(dummy);
                dummy.add(camera);

                camera.position.z = 5;
                
                var n = 1000000;

                var pt_buffer = new THREE.BufferGeometry();
                
                var colours = new Float32Array(n*3);
                for(i=0;i<n;i++)
                {
                    var rgb = plasma_cmap(i/n);
                    
                    /*colours[i*3] = rgb.r;
                    colours[i*3+1] = rgb.g;
                    colours[i*3+2] = rgb.b;                    */

                    colours[i*3] = col_array.data[i*3]/255.0;
                    colours[i*3+1] = col_array.data[i*3+1]/255.0;
                    colours[i*3+2] = col_array.data[i*3+2]/255.0;                    
                }
                
                pt_buffer.addAttribute('position', new THREE.BufferAttribute(pt_array.data, 3));
                
                pt_buffer.addAttribute('color', new THREE.BufferAttribute(colours, 3));
                

                var material = new THREE.PointsMaterial( { size:0.008, sizeAttenuation: true, vertexColors: THREE.VertexColors, opacity:0.1, transparent:true,
                    blending:THREE.AdditiveBlending, depthTest:false
                
                } );
                var pts = new THREE.Points( pt_buffer,  material );
                pt_buffer.scale(0.2, 0.2, 1.0);
                scene.add(pts);

                animate();
            }

     
            function onloaded_stage_1 (pt_array)
            {
                
                
                NumpyLoader.ajax("1e6_pts_rgb.npy", function (col_array) { onloaded(pt_array, col_array); });
            }

            NumpyLoader.ajax("1e6_pts_3d.npy", onloaded_stage_1);
   
        </script>

        
	</body>
</html>